import{_ as U,r as x,e as N,u as O,a as G,w as Q,o as J,b as k,c as u,d as f,f as t,g as m,F as A,h as K,t as d,n as D,i as Z,j as z,k as ee,p as X,l as Y,m as te,q as ae,s as R}from"./index-cdbe0156.js";const $=p=>(X("data-v-c34b721d"),p=p(),Y(),p),le={class:"w-100 mb-2 d-block d-md-none"},oe=$(()=>t("span",null," Close",-1)),se=["checked"],ne=$(()=>t("p",{for:"date-valid",class:"pb-1"}," 顯示已結束展覽 ",-1)),re={class:"mb-3"},ce=$(()=>t("p",{class:"fw-bold mb-2"},"類型",-1)),ie={class:"type-list rounded-3 border mb-1"},de={class:"border-bottom p-2"},ue=["checked"],pe=$(()=>t("span",{for:"type-all"},"全部",-1)),ve=["onClick"],ye=["id","value","checked"],be=["for"],_e={class:"d-flex px-1"},he={class:"mb-2"},fe=$(()=>t("p",{class:"fw-bold mb-2"},"展覽期間",-1)),me=$(()=>t("p",{class:"mb-2 fw-bold"},"價格",-1)),ge={class:"d-flex flex-column"},xe=$(()=>t("p",{class:"mb-1 fs-7"},"最小票價",-1)),we={key:1,class:"errorMessage"},De={class:"d-flex flex-column"},ke=$(()=>t("p",{class:"mb-1 fs-7"},"最大票價",-1)),$e={key:1,class:"errorMessage"},Pe={class:"fs-7 mb-2 fw-bold"},Ve={class:"city-list border rounded-3"},Se={class:"p-2 border-bottom"},Ce=["checked"],qe=$(()=>t("span",{for:"all"},"全部",-1)),Ie=["onClick"],Le=["id","value","checked"],Fe=["for"],Ee={__name:"Filter",props:{isFilterShow:Boolean,filterShowHandler:Function,resetKeyName:String},emits:["reset"],setup(p,{emit:v}){const h=p,M=["臺北","新北","桃園","臺中","臺南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","臺東","澎湖","金門","連江","基隆"],c=x({typeArr:[],cityArr:M,cityKeyWord:"",typeQuantity:5}),w=x(N()),P=O(),g=G(),a=x({dateValid:!1,type:"all",startDate:0,endDate:0,minPrice:0,maxPrice:1e5,city:"all"});Q(h,()=>{switch(h.resetKeyName){case"dateValid":a.value.dateValid=!1,v("reset","all");break;case"type":a.value.type="all",v("reset","all");break;case"startDate":console.log("startDate"),a.value.startDate=0,v("reset","all");break;case"endDate":console.log("endDate"),a.value.endDate=0,v("reset","all");break;case"minPrice":console.log("minPrice"),a.value.minPrice=0,v("reset","all");break;case"maxPrice":console.log("maxPrice"),a.value.maxPrice=1e5,v("reset","all");break;case"city":console.log("city"),a.value.city="all",v("reset","all");break}});const H=r=>{r.preventDefault()};J(async()=>{w.value.exhibitionList.length===0&&await w.value.getAllExhibitionData(),T(),console.log("[BeforeMount]",w.value.exhibitionList),console.log("[BeforeMount]",P.query),Q(a.value,r=>{typeof a.value.startDate=="object"&&(a.value.startDate=new Date(a.value.startDate).getTime()),typeof a.value.endDate=="object"&&(a.value.endDate=new Date(a.value.endDate).getTime()),g.replace({name:"SearchExhibition",query:{...P.query,...a.value}})})});const T=()=>{if(c.value.typeArr=Array.from(new Set(w.value.exhibitionList.map(r=>r.type))),Object.keys(P.query).length>0){const{dateValid:r,type:o,startDate:W,endDate:q,minPrice:I,maxPrice:L,city:E}=P.query,e={dateValid:r==="true",type:o,startDate:parseInt(W),endDate:parseInt(q),minPrice:parseInt(I),maxPrice:parseInt(L),city:E};a.value={...a.value,...e}}},V=(r,o)=>{console.log("click",r,o),a.value[`${r}`]=o,console.log("[fetch Data]",123)},F=r=>{r.preventDefault(),c.value.cityKeyWord=r.target.value,r.target.value===""&&(c.value.cityArr=M),console.log(c.value.cityArr.filter(o=>o.includes(r.target.value))),c.value.cityArr=M.filter(o=>o.includes(r.target.value))},S=r=>{switch(r){case"add":c.value.typeQuantity+=5;break;case"reset":c.value.typeQuantity=5;break}};return(r,o)=>{const W=k("CloseIcon"),q=k("DatePicker"),I=k("VeeField"),L=k("ErrorMessage"),E=k("VeeForm");return u(),f("div",{class:D(`side border-end ${p.isFilterShow?"w-0":"border-none"}`)},[t("div",{class:D(`m-4 ${p.isFilterShow&&"d-none"}`)},[t("div",le,[t("button",{class:"btn border",onClick:o[0]||(o[0]=(...e)=>p.filterShowHandler&&p.filterShowHandler(...e))},[m(W),oe])]),t("div",{onClick:o[1]||(o[1]=e=>V("dateValid",!a.value.dateValid)),class:"d-flex gap-2 align-items-center border-bottom pb-4 mb-4 px-3"},[t("input",{id:"date-valid",type:"checkbox",name:"checkbox",checked:a.value.dateValid},null,8,se),ne]),t("div",re,[ce,t("ul",ie,[t("li",de,[t("div",{onClick:o[2]||(o[2]=e=>V("type","all"))},[t("input",{class:"me-2",id:"type-all",type:"radio",name:"type",value:"all",checked:a.value.type==="all"},null,8,ue),pe])]),(u(!0),f(A,null,K(c.value.typeArr.slice(0,c.value.typeQuantity),(e,n)=>(u(),f("li",{class:"p-2 border-bottom",key:n},[t("div",{onClick:y=>V("type",e)},[t("input",{class:"me-2",id:e,type:"radio",name:"type",value:e,checked:a.value.type===e},null,8,ye),t("span",{class:"",for:e},d(e),9,be)],8,ve)]))),128))]),t("div",_e,[t("button",{class:D(`border-0 bg-transparent fw-bold ${c.value.typeQuantity<6&&"d-none"}`),type:"button",onClick:o[3]||(o[3]=e=>S("reset"))}," 收回 ",2),t("button",{onClick:o[4]||(o[4]=e=>S("add")),class:D(`border-0 bg-transparent fw-bold ms-auto ${c.value.typeArr.length<5&&"d-none"}`),type:"button"}," 顯示更多 ",2)])]),t("div",he,[fe,m(q,{modelValue:a.value.startDate,"onUpdate:modelValue":o[5]||(o[5]=e=>a.value.startDate=e),class:"mb-2",type:"number",placeholder:"開始時間"},null,8,["modelValue"]),m(q,{placeholder:"結束時間",modelValue:a.value.endDate,"onUpdate:modelValue":o[6]||(o[6]=e=>a.value.endDate=e)},null,8,["modelValue"])]),me,m(E,{onSubmit:H},{default:Z(({errors:e})=>[t("div",ge,[xe,m(I,{modelValue:a.value.minPrice,"onUpdate:modelValue":o[7]||(o[7]=n=>a.value.minPrice=n),class:D(`border rounded py-1 px-2 ${e.最小價格?"border-danger":"border"}`),placeholder:"最小價格",name:"最小價格",type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:0,max_value:a.value.maxPrice,numeric:!0}},null,8,["modelValue","class","rules"]),e.最小價格?(u(),z(L,{key:0,as:"p",class:"text-danger errorMessage",name:"最小價格"})):(u(),f("p",we))]),t("div",De,[ke,m(I,{modelValue:a.value.maxPrice,"onUpdate:modelValue":o[8]||(o[8]=n=>a.value.maxPrice=n),class:D(`border rounded py-1 px-2 ${e.最大價格?"border-danger":"border"}`),placeholder:"最大價格",name:"最大價格",type:"number",max:"100000",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:a.value.minPrice,max_value:1e5,numeric:!0}},null,8,["modelValue","class","rules"]),e.最大價格?(u(),z(L,{key:0,as:"p",class:"text-danger errorMessage",name:"最大價格"})):(u(),f("p",$e))])]),_:1}),t("div",null,[t("p",Pe,"城市 "+d(c.value.cityKeyWord),1),t("input",{onInput:F,class:"border w-100 rounded px-2 py-1 mb-2",type:"search",placeholder:"篩選城市名稱",name:"cityKeyWord",id:"cityKeyWord"},null,32),t("ul",Ve,[t("li",Se,[t("div",{onClick:o[9]||(o[9]=e=>V("city","all"))},[t("input",{class:"me-2",id:"all",type:"radio",name:"city",value:"all",checked:a.value.city==="all"},null,8,Ce),qe])]),(u(!0),f(A,null,K(c.value.cityArr,(e,n)=>(u(),f("li",{class:"p-2 border-bottom",key:n},[t("div",{onClick:y=>V("city",e)},[t("input",{class:"me-2",id:e,type:"radio",name:"city",value:e,checked:a.value.city===e},null,8,Le),t("span",{class:"",for:e},d(e),9,Fe)],8,Ie)]))),128))])])],2),ee(" "+d(p.resetKeyName),1)],2)}}},Me=U(Ee,[["__scopeId","data-v-c34b721d"]]);const j=p=>(X("data-v-a713f38f"),p=p(),Y(),p),We={class:"d-flex"},Ae={class:"container position-relative px-3"},Ke={class:"mt-5 rounded-3"},He={class:"mb-2"},Be={class:"mb-2"},Qe={class:"fs-7"},je={class:"d-flex gap-2 mb-4"},Te=["onClick"],ze={class:""},Re=j(()=>t("span",null," 篩選器",-1)),Ue={class:"row"},Ne={class:"border position-relative shadow rounded-3 overflow-hidden"},Oe={class:"position-absolute bg-secondary text-white px-3 py-2 border-bottom-end-3"},Ge={class:"rounded"},Je=["src","alt"],Xe={class:"p-3"},Ye={class:"card-title fw-bold"},Ze={class:"d-flex gap-2 mb-1"},et=j(()=>t("span",null,"~",-1)),tt={class:"d-flex"},at={class:"border py-1 px-2 bg-success text-white rounded-pill fs-7"},lt={class:"d-flex justify-content-center gap-1 mt-5 mb-5"},ot=j(()=>t("span",null,"返回",-1)),st={class:"pagination d-flex gap-1"},nt=["onClick"],rt=j(()=>t("span",null,"更多",-1)),ct={__name:"SearchExhibition",setup(p){const v=N(),h=O(),M=G(),c=x(""),w=x(),P=x(""),g=x([...v.exhibitionList]),a=x({nextBtnDisable:!1,counter:0,pageView:3,limit:8,currentPage:1}),H=x([]),T=e=>{a.value.currentPage=e},V=e=>{const n=g.value.length%a.value.limit>0?1:0,y=Math.floor(g.value.length/a.value.limit)+n,s=Math.ceil(y/a.value.pageView);switch(e){case"next":if(a.value.counter+1>=s)return;console.log(a.value.counter,s),a.value.counter++,a.value.currentPage=a.value.counter*a.value.pageView+1;break;case"pre":if(a.value.counter===0)return;a.value.counter--,a.value.currentPage=a.value.counter*a.value.pageView+1;break}},F=()=>{H.value=Array.from(Array(Math.ceil(g.value.length/a.value.limit)).keys()).slice(a.value.counter*a.value.pageView,(a.value.counter+1)*a.value.pageView)},S=x(!1),r=()=>{S.value=!S.value,S.value===!1?window.matchMedia("(min-width:768px)")&&(document.querySelector("body").style="overflow:hidden"):document.querySelector("body").style=null},o=()=>{P.value=""},W=e=>{P.value=e},q=e=>{const{city:n,dateValid:y,startDate:s,endDate:i,maxPrice:B,minPrice:l,type:b}=e,_={dateValid:y==="false"?null:y,city:n==="all"?null:n,startDate:s!=="0"&&s!==void 0?parseInt(s):null,endDate:i!=="0"&&i!==void 0?parseInt(i):null,maxPrice:B==="100000"?null:parseInt(B),minPrice:l==="0"?null:parseInt(l),type:b==="all"?null:b};Object.keys(_).forEach(C=>{(_[C]===null||_[C]===void 0)&&delete _[C],(C==="maxPrice"||C==="minPrice")&&isNaN(_[C])&&delete _[C]}),(_.maxPrice<_.minPrice||_.maxPrice>1e5)&&(delete _.maxPrice,delete _.minPrice),F(),w.value={..._}},I=te.debounce(e=>{c.value=e.target.value,M.replace({name:"SearchExhibition",query:{...h.query,keyWord:c.value}})},300),L=()=>{console.log("[filterExhList start]",w.value);let e=[...v.exhibitionList];const n=w.value;Object.keys(n).map(y=>y).length===0&&console.log("全部展示"),Object.entries(n).forEach(([y,s])=>{switch(console.log(y,s),y){case"dateValid":if(s===!1)return;e=e.filter(i=>i.endDate>new Date().getTime()),console.log("篩選中-1:dateValid",e);break;case"city":if(s==="all")return;e=e.filter(i=>i.location.country===s),console.log("篩選中-2:city",e);break;case"startDate":if(s===0)return;e=e.filter(i=>i.startDate>=s),console.log("篩選中-3:startDate",e);break;case"endDate":if(s===0)return;e=e.filter(i=>i.endDate<=s);break;case"maxPrice":if(s===0)return;e=e.filter(i=>i.maxPrice>=s);break;case"minPrice":if(s===0)return;e=e.filter(i=>i.minPice<=s);break;case"type":if(s==="all")return;e=e.filter(i=>i.type===s)}}),h.query.keyWord!==""&&h.query.keyWord&&(console.log(h.query.keyWord),e=e.filter(y=>y.name.includes(h.query.keyWord)),console.log("search",e)),g.value=e,console.log("[filterExhlist] result:",g.value)},E=()=>{const e=window.matchMedia("(max-width:768px)");console.log(e),e.matches===!1&&(document.querySelector("body").style=null),e.matches===!0&&S?document.querySelector("body").style="overflow:hidden":document.querySelector("body").style=null};return J(async()=>{v.exhibitionList.length===0&&await v.getAllExhibitionData(),q(h.query),h.query.keyWord&&(document.querySelector(".search-keyword").value=h.query.keyWord,c.value=h.query.keyWord),g.value=v==null?void 0:v.exhibitionList.filter(e=>e.endDate>new Date().getTime()),L(),F(),Q(a.value,()=>{F()}),window.addEventListener("resize",E)}),ae(()=>{window.removeEventListener("resize",E)}),Q(h,()=>{q(h.query),L(),a.value.counter=0,a.value.currentPage=1,F()}),(e,n)=>{const y=k("CloseIcon"),s=k("FilterMenu"),i=k("ChevronLeft"),B=k("ChevronRight");return u(),f("div",We,[m(Me,{"is-filter-show":S.value,"filter-show-handler":r,resetKeyName:P.value,onReset:o},null,8,["is-filter-show","resetKeyName"]),t("div",Ae,[t("div",Ke,[t("div",He,[t("input",{onInput:n[0]||(n[0]=(...l)=>R(I)&&R(I)(...l)),class:"search-keyword border rounded-1 px-2 py-1",type:"search",placeholder:"輸入展覽名稱"},null,32)]),t("div",Be,[t("p",{class:D(`fs-7 ${!c.value.length>0&&"d-none"}`)}," 搜索關鍵字："+d(c.value),3),t("p",Qe,"總搜索筆數("+d(g.value.length)+")",1)]),t("div",je,[(u(!0),f(A,null,K(w.value,(l,b,_)=>(u(),f("div",{class:"d-flex gap-2 align-items-center fs-7 border bg-transparent p-1 rounded",key:_},[t("button",{class:"p-0 border-0 bg-transparent",onClick:C=>W(b)},[m(y,{size:18})],8,Te),t("p",ze,d(`${b==="dateValid"?"顯示結束展覽":""}`)+" "+d(`${b==="startDate"?`始於 ${new Date(l).toLocaleDateString()}`:""}`)+" "+d(`${b==="endDate"?`結束 ${new Date(l).toLocaleDateString()}`:""}`)+" "+d(`${b==="type"?`類別 ${l}`:""}`)+" "+d(`${b==="minPrice"?`最小價格 ${l}`:""}`)+" "+d(`${b==="maxPrice"?`最大價格 ${l}`:""}`)+" "+d(`${b==="city"?`城市 ${l}`:""}`),1)]))),128))])]),t("button",{class:"btn",type:"button",onClick:r},[m(s),Re]),t("div",Ue,[(u(!0),f(A,null,K(g.value.slice(a.value.limit*(a.value.currentPage-1),a.value.limit*a.value.currentPage),(l,b)=>(u(),f("div",{key:b,class:"col-12 col-md-6 col-lg-4 col-xl-3 mb-4"},[t("div",Ne,[t("div",Oe,d(l==null?void 0:l.location.country),1),t("div",Ge,[t("img",{class:"image-box hover-scale",src:l==null?void 0:l.image,alt:l.name},null,8,Je)]),t("div",Xe,[t("div",Ye,[t("p",null,d(l==null?void 0:l.name),1)]),t("div",Ze,[t("span",null,d(new Date(l==null?void 0:l.startDate).toLocaleDateString()),1),et,t("span",null,d(new Date(l==null?void 0:l.endDate).toLocaleDateString()),1)]),t("ul",tt,[t("li",at,d(l==null?void 0:l.type),1)])])])]))),128))]),t("nav",lt,[t("button",{onClick:n[1]||(n[1]=l=>V("pre")),class:"p-1 border border-1 rounded bg-transparent"},[m(i),ot]),t("ul",st,[(u(!0),f(A,null,K(H.value,(l,b)=>(u(),f("li",{onClick:_=>T(l+1),key:b,class:D(`border p-2 rounded ${a.value.currentPage===l+1&&" bg-primary text-white"}`)},[t("button",{class:D(`border-0 bg-transparent ${a.value.currentPage===l+1&&"  text-white"}`)},d(l+1),3)],10,nt))),128))]),t("button",{onClick:n[2]||(n[2]=l=>V("next")),class:"p-1 border border-1 rounded bg-transparent"},[m(B),rt])])])])}}},dt=U(ct,[["__scopeId","data-v-a713f38f"]]);export{dt as default};
