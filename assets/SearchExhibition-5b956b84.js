import{_ as R,r as g,e as U,u as N,a as O,w as B,o as G,b as D,c as v,d as f,f as e,g as m,F as W,h as K,t as u,n as F,i as Y,j as T,k as Z,p as J,l as X,m as ee,q as te,s as z}from"./index-fd7a6166.js";const k=y=>(J("data-v-c34b721d"),y=y(),X(),y),ae={class:"w-100 mb-2 d-block d-md-none"},le=k(()=>e("span",null," Close",-1)),oe=["checked"],se=k(()=>e("p",{for:"date-valid",class:"pb-1"}," 顯示已結束展覽 ",-1)),ne={class:"mb-3"},re=k(()=>e("p",{class:"fw-bold mb-2"},"類型",-1)),ce={class:"type-list rounded-3 border mb-1"},ie={class:"border-bottom p-2"},de=["checked"],ue=k(()=>e("span",{for:"type-all"},"全部",-1)),pe=["onClick"],ve=["id","value","checked"],ye=["for"],be={class:"d-flex px-1"},_e={class:"mb-2"},he=k(()=>e("p",{class:"fw-bold mb-2"},"展覽期間",-1)),fe=k(()=>e("p",{class:"mb-2 fw-bold"},"價格",-1)),me={class:"d-flex flex-column"},ge=k(()=>e("p",{class:"mb-1 fs-7"},"最小票價",-1)),xe={key:1,class:"errorMessage"},we={class:"d-flex flex-column"},De=k(()=>e("p",{class:"mb-1 fs-7"},"最大票價",-1)),ke={key:1,class:"errorMessage"},$e={class:"fs-7 mb-2 fw-bold"},Pe={class:"city-list border rounded-3"},Ve={class:"p-2 border-bottom"},Se=["checked"],Ce=k(()=>e("span",{for:"all"},"全部",-1)),qe=["onClick"],Ie=["id","value","checked"],Le=["for"],Fe={__name:"Filter",props:{isFilterShow:Boolean,filterShowHandler:Function,resetKeyName:String},emits:["reset"],setup(y,{emit:b}){const h=y,A=["臺北","新北","桃園","臺中","臺南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","臺東","澎湖","金門","連江","基隆"],c=g({typeArr:[],cityArr:A,cityKeyWord:"",typeQuantity:5}),x=g(U()),$=N(),w=O(),t=g({dateValid:!1,type:"all",startDate:0,endDate:0,minPrice:0,maxPrice:1e5,city:"all"});B(h,()=>{switch(h.resetKeyName){case"dateValid":t.value.dateValid=!1,b("reset","all");break;case"type":t.value.type="all",b("reset","all");break;case"startDate":console.log("startDate"),t.value.startDate=0,b("reset","all");break;case"endDate":console.log("endDate"),t.value.endDate=0,b("reset","all");break;case"minPrice":console.log("minPrice"),t.value.minPrice=0,b("reset","all");break;case"maxPrice":console.log("maxPrice"),t.value.maxPrice=1e5,b("reset","all");break;case"city":console.log("city"),t.value.city="all",b("reset","all");break}});const S=r=>{r.preventDefault()};G(async()=>{x.value.exhibitionList.length===0&&await x.value.getAllExhibitionData(),j(),console.log("[BeforeMount]",x.value.exhibitionList),console.log("[BeforeMount]",$.query),B(t.value,r=>{typeof t.value.startDate=="object"&&(t.value.startDate=new Date(t.value.startDate).getTime()),typeof t.value.endDate=="object"&&(t.value.endDate=new Date(t.value.endDate).getTime()),w.replace({name:"SearchExhibition",query:{...$.query,...t.value}})})});const j=()=>{if(c.value.typeArr=Array.from(new Set(x.value.exhibitionList.map(r=>r.type))),Object.keys($.query).length>0){const{dateValid:r,type:s,startDate:E,endDate:q,minPrice:I,maxPrice:L,city:l}=$.query,a={dateValid:r==="true",type:s,startDate:parseInt(E),endDate:parseInt(q),minPrice:parseInt(I),maxPrice:parseInt(L),city:l};t.value={...t.value,...a}}},P=(r,s)=>{console.log("click",r,s),t.value[`${r}`]=s,console.log("[fetch Data]",123)},C=r=>{r.preventDefault(),c.value.cityKeyWord=r.target.value,r.target.value===""&&(c.value.cityArr=A),console.log(c.value.cityArr.filter(s=>s.includes(r.target.value))),c.value.cityArr=A.filter(s=>s.includes(r.target.value))},M=r=>{switch(r){case"add":c.value.typeQuantity+=5;break;case"reset":c.value.typeQuantity=5;break}};return(r,s)=>{const E=D("CloseIcon"),q=D("DatePicker"),I=D("VeeField"),L=D("ErrorMessage"),l=D("VeeForm");return v(),f("div",{class:F(`side border-end ${y.isFilterShow?"w-0":"border-none"}`)},[e("div",{class:F(`m-4 ${y.isFilterShow&&"d-none"}`)},[e("div",ae,[e("button",{class:"btn border",onClick:s[0]||(s[0]=(...a)=>y.filterShowHandler&&y.filterShowHandler(...a))},[m(E),le])]),e("div",{onClick:s[1]||(s[1]=a=>P("dateValid",!t.value.dateValid)),class:"d-flex gap-2 align-items-center border-bottom pb-4 mb-4 px-3"},[e("input",{id:"date-valid",type:"checkbox",name:"checkbox",checked:t.value.dateValid},null,8,oe),se]),e("div",ne,[re,e("ul",ce,[e("li",ie,[e("div",{onClick:s[2]||(s[2]=a=>P("type","all"))},[e("input",{class:"me-2",id:"type-all",type:"radio",name:"type",value:"all",checked:t.value.type==="all"},null,8,de),ue])]),(v(!0),f(W,null,K(c.value.typeArr.slice(0,c.value.typeQuantity),(a,i)=>(v(),f("li",{class:"p-2 border-bottom",key:i},[e("div",{onClick:n=>P("type",a)},[e("input",{class:"me-2",id:a,type:"radio",name:"type",value:a,checked:t.value.type===a},null,8,ve),e("span",{class:"",for:a},u(a),9,ye)],8,pe)]))),128))]),e("div",be,[e("button",{class:F(`border-0 bg-transparent fw-bold ${c.value.typeQuantity<6&&"d-none"}`),type:"button",onClick:s[3]||(s[3]=a=>M("reset"))}," 收回 ",2),e("button",{onClick:s[4]||(s[4]=a=>M("add")),class:F(`border-0 bg-transparent fw-bold ms-auto ${c.value.typeArr.length<5&&"d-none"}`),type:"button"}," 顯示更多 ",2)])]),e("div",_e,[he,m(q,{modelValue:t.value.startDate,"onUpdate:modelValue":s[5]||(s[5]=a=>t.value.startDate=a),class:"mb-2",type:"number",placeholder:"開始時間"},null,8,["modelValue"]),m(q,{placeholder:"結束時間",modelValue:t.value.endDate,"onUpdate:modelValue":s[6]||(s[6]=a=>t.value.endDate=a)},null,8,["modelValue"])]),fe,m(l,{onSubmit:S},{default:Y(({errors:a})=>[e("div",me,[ge,m(I,{modelValue:t.value.minPrice,"onUpdate:modelValue":s[7]||(s[7]=i=>t.value.minPrice=i),class:F(`border rounded py-1 px-2 ${a.最小價格?"border-danger":"border"}`),placeholder:"最小價格",name:"最小價格",type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:0,max_value:t.value.maxPrice,numeric:!0}},null,8,["modelValue","class","rules"]),a.最小價格?(v(),T(L,{key:0,as:"p",class:"text-danger errorMessage",name:"最小價格"})):(v(),f("p",xe))]),e("div",we,[De,m(I,{modelValue:t.value.maxPrice,"onUpdate:modelValue":s[8]||(s[8]=i=>t.value.maxPrice=i),class:F(`border rounded py-1 px-2 ${a.最大價格?"border-danger":"border"}`),placeholder:"最大價格",name:"最大價格",type:"number",max:"100000",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:t.value.minPrice,max_value:1e5,numeric:!0}},null,8,["modelValue","class","rules"]),a.最大價格?(v(),T(L,{key:0,as:"p",class:"text-danger errorMessage",name:"最大價格"})):(v(),f("p",ke))])]),_:1}),e("div",null,[e("p",$e,"城市 "+u(c.value.cityKeyWord),1),e("input",{onInput:C,class:"border w-100 rounded px-2 py-1 mb-2",type:"search",placeholder:"篩選城市名稱",name:"cityKeyWord",id:"cityKeyWord"},null,32),e("ul",Pe,[e("li",Ve,[e("div",{onClick:s[9]||(s[9]=a=>P("city","all"))},[e("input",{class:"me-2",id:"all",type:"radio",name:"city",value:"all",checked:t.value.city==="all"},null,8,Se),Ce])]),(v(!0),f(W,null,K(c.value.cityArr,(a,i)=>(v(),f("li",{class:"p-2 border-bottom",key:i},[e("div",{onClick:n=>P("city",a)},[e("input",{class:"me-2",id:a,type:"radio",name:"city",value:a,checked:t.value.city===a},null,8,Ie),e("span",{class:"",for:a},u(a),9,Le)],8,qe)]))),128))])])],2),Z(" "+u(y.resetKeyName),1)],2)}}},Ee=R(Fe,[["__scopeId","data-v-c34b721d"]]);const Q=y=>(J("data-v-fdfc754b"),y=y(),X(),y),Ae={class:"d-flex"},Me={class:"container position-relative px-3"},We={class:"mt-5 rounded-3"},Ke={class:"mb-2"},He={class:"mb-2"},Be={class:"fs-7"},Qe={class:"d-flex gap-2 mb-4"},je=["onClick"],Te={class:""},ze=Q(()=>e("span",null," 篩選器",-1)),Re={class:"row"},Ue={class:"border position-relative shadow rounded-3 overflow-hidden"},Ne={class:"position-absolute bg-secondary text-white px-3 py-2 border-bottom-end-3"},Oe={class:"rounded"},Ge=["src","alt"],Je={class:"p-3"},Xe={class:"card-title fw-bold"},Ye={class:"d-flex gap-2 mb-1"},Ze=Q(()=>e("span",null,"~",-1)),et={class:"d-flex"},tt={class:"border py-1 px-2 bg-success text-white rounded-pill fs-7"},at={class:"d-flex justify-content-center gap-1 mt-5 mb-5"},lt=Q(()=>e("span",null,"上一頁",-1)),ot={class:"pagination d-flex gap-1"},st=["onClick"],nt={class:"border-0 bg-transparent"},rt=Q(()=>e("span",null,"下一頁",-1)),ct={__name:"SearchExhibition",setup(y){const b=U(),h=N(),A=O(),c=g(""),x=g(),$=g(""),w=g([...b.exhibitionList]),t=g({nextBtnDisable:!1,counter:0,pageView:2,limit:8,currentPage:1}),S=g([]),j=l=>{t.value.currentPage=l},P=l=>{switch(console.log(t.value.maxPage),l){case"next":t.value.counter++,console.log(S.value[S.value.length-1]+1);break;case"pre":if(t.value.counter===0)return;t.value.counter--,console.log(t.value.counter);break}},C=g(!1),M=()=>{C.value=!C.value,C.value===!1?window.matchMedia("(min-width:768px)")&&(document.querySelector("body").style="overflow:hidden"):document.querySelector("body").style=null},r=()=>{$.value=""},s=l=>{$.value=l},E=l=>{const{city:a,dateValid:i,startDate:n,endDate:d,maxPrice:H,minPrice:o,type:p}=l,_={dateValid:i==="false"?null:i,city:a==="all"?null:a,startDate:n!=="0"&&n!==void 0?parseInt(n):null,endDate:d!=="0"&&d!==void 0?parseInt(d):null,maxPrice:H==="100000"?null:parseInt(H),minPrice:o==="0"?null:parseInt(o),type:p==="all"?null:p};Object.keys(_).forEach(V=>{(_[V]===null||_[V]===void 0)&&delete _[V],(V==="maxPrice"||V==="minPrice")&&isNaN(_[V])&&delete _[V]}),(_.maxPrice<_.minPrice||_.maxPrice>1e5)&&(delete _.maxPrice,delete _.minPrice),x.value={..._}},q=ee.debounce(l=>{c.value=l.target.value,A.replace({name:"SearchExhibition",query:{...h.query,keyWord:c.value}})},300),I=()=>{console.log("[filterExhList start]",x.value);let l=[...b.exhibitionList];const a=x.value;Object.keys(a).map(i=>i).length===0&&console.log("全部展示"),Object.entries(a).forEach(([i,n])=>{switch(console.log(i,n),i){case"dateValid":if(n===!1)return;l=l.filter(d=>d.endDate>new Date().getTime()),console.log("篩選中-1:dateValid",l);break;case"city":if(n==="all")return;l=l.filter(d=>d.location.country===n),console.log("篩選中-2:city",l);break;case"startDate":if(n===0)return;l=l.filter(d=>d.startDate>=n),console.log("篩選中-3:startDate",l);break;case"endDate":if(n===0)return;l=l.filter(d=>d.endDate<=n);break;case"maxPrice":if(n===0)return;l=l.filter(d=>d.maxPrice>=n);break;case"minPrice":if(n===0)return;l=l.filter(d=>d.minPice<=n);break;case"type":if(n==="all")return;l=l.filter(d=>d.type===n)}}),h.query.keyWord!==""&&h.query.keyWord&&(console.log(h.query.keyWord),l=l.filter(i=>i.name.includes(h.query.keyWord)),console.log("search",l)),w.value=l,console.log("[filterExhlist] result:",w.value)},L=()=>{const l=window.matchMedia("(max-width:768px)");console.log(l),l.matches===!1&&(document.querySelector("body").style=null),l.matches===!0&&C?document.querySelector("body").style="overflow:hidden":document.querySelector("body").style=null};return G(async()=>{b.exhibitionList.length===0&&await b.getAllExhibitionData(),E(h.query),h.query.keyWord&&(document.querySelector(".search-keyword").value=h.query.keyWord,c.value=h.query.keyWord),w.value=b==null?void 0:b.exhibitionList.filter(l=>l.endDate>new Date().getTime()),I(),S.value=Array.from(Array(Math.ceil(w.value.length/t.value.limit)).keys()).slice(t.value.counter*t.value.pageView,(t.value.counter+1)*t.value.pageView),B(t.value,()=>{S.value=Array.from(Array(Math.ceil(w.value.length/t.value.limit)).keys()).slice(t.value.counter*t.value.pageView,(t.value.counter+1)*t.value.pageView)}),window.addEventListener("resize",L)}),te(()=>{window.removeEventListener("resize",L)}),B(h,()=>{E(h.query),I()}),(l,a)=>{const i=D("CloseIcon"),n=D("FilterMenu"),d=D("ChevronLeft"),H=D("ChevronRight");return v(),f("div",Ae,[m(Ee,{"is-filter-show":C.value,"filter-show-handler":M,resetKeyName:$.value,onReset:r},null,8,["is-filter-show","resetKeyName"]),e("div",Me,[e("div",We,[e("div",Ke,[e("input",{onInput:a[0]||(a[0]=(...o)=>z(q)&&z(q)(...o)),class:"search-keyword border rounded-1 px-2 py-1",type:"search",placeholder:"輸入展覽名稱"},null,32)]),e("div",He,[e("p",{class:F(`fs-7 ${!c.value.length>0&&"d-none"}`)}," 搜索關鍵字："+u(c.value),3),e("p",Be,"總搜索筆數("+u(w.value.length)+")",1)]),e("div",Qe,[(v(!0),f(W,null,K(x.value,(o,p,_)=>(v(),f("div",{class:"d-flex gap-2 align-items-center fs-7 border bg-transparent p-1 rounded",key:_},[e("button",{class:"p-0 border-0 bg-transparent",onClick:V=>s(p)},[m(i,{size:18})],8,je),e("p",Te,u(`${p==="dateValid"?"顯示結束展覽":""}`)+" "+u(`${p==="startDate"?`始於 ${new Date(o).toLocaleDateString()}`:""}`)+" "+u(`${p==="endDate"?`結束 ${new Date(o).toLocaleDateString()}`:""}`)+" "+u(`${p==="type"?`類別 ${o}`:""}`)+" "+u(`${p==="minPrice"?`最小價格 ${o}`:""}`)+" "+u(`${p==="maxPrice"?`最大價格 ${o}`:""}`)+" "+u(`${p==="city"?`城市 ${o}`:""}`),1)]))),128))])]),e("button",{class:"btn",type:"button",onClick:M},[m(n),ze]),e("div",Re,[(v(!0),f(W,null,K(w.value.slice(t.value.limit*(t.value.currentPage-1),t.value.limit*t.value.currentPage),(o,p)=>(v(),f("div",{key:p,class:"col-12 col-md-6 col-lg-4 col-xl-3 mb-4"},[e("div",Ue,[e("div",Ne,u(o==null?void 0:o.location.country),1),e("div",Oe,[e("img",{class:"image-box hover-scale",src:o==null?void 0:o.image,alt:o.name},null,8,Ge)]),e("div",Je,[e("div",Xe,[e("p",null,u(o==null?void 0:o.name),1)]),e("div",Ye,[e("span",null,u(new Date(o==null?void 0:o.startDate).toLocaleDateString()),1),Ze,e("span",null,u(new Date(o==null?void 0:o.endDate).toLocaleDateString()),1)]),e("ul",et,[e("li",tt,u(o==null?void 0:o.type),1)])])])]))),128))]),e("nav",at,[e("button",{onClick:a[1]||(a[1]=o=>P("pre")),class:"p-1 border border-1 rounded bg-transparent"},[m(d),lt]),e("ul",ot,[(v(!0),f(W,null,K(S.value,(o,p)=>(v(),f("li",{onClick:_=>j(p+1),key:p,class:"border p-2 rounded"},[e("button",nt,u(o+1),1)],8,st))),128))]),e("button",{onClick:a[2]||(a[2]=o=>P("next")),class:"p-1 border border-1 rounded bg-transparent"},[m(H),rt])])])])}}},dt=R(ct,[["__scopeId","data-v-fdfc754b"]]);export{dt as default};
