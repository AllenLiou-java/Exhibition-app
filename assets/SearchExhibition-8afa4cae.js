import{_ as R,r as g,e as U,u as N,a as O,w as B,o as G,b as k,c as v,d as f,f as e,g as m,F as W,h as K,t as u,n as D,i as Y,j as T,k as Z,p as J,l as X,m as ee,q as te,s as z}from"./index-3e316cba.js";const $=y=>(J("data-v-c34b721d"),y=y(),X(),y),ae={class:"w-100 mb-2 d-block d-md-none"},le=$(()=>e("span",null," Close",-1)),oe=["checked"],se=$(()=>e("p",{for:"date-valid",class:"pb-1"}," 顯示已結束展覽 ",-1)),ne={class:"mb-3"},re=$(()=>e("p",{class:"fw-bold mb-2"},"類型",-1)),ie={class:"type-list rounded-3 border mb-1"},ce={class:"border-bottom p-2"},de=["checked"],ue=$(()=>e("span",{for:"type-all"},"全部",-1)),pe=["onClick"],ve=["id","value","checked"],ye=["for"],be={class:"d-flex px-1"},he={class:"mb-2"},_e=$(()=>e("p",{class:"fw-bold mb-2"},"展覽期間",-1)),fe=$(()=>e("p",{class:"mb-2 fw-bold"},"價格",-1)),me={class:"d-flex flex-column"},ge=$(()=>e("p",{class:"mb-1 fs-7"},"最小票價",-1)),xe={key:1,class:"errorMessage"},we={class:"d-flex flex-column"},De=$(()=>e("p",{class:"mb-1 fs-7"},"最大票價",-1)),ke={key:1,class:"errorMessage"},$e={class:"fs-7 mb-2 fw-bold"},Pe={class:"city-list border rounded-3"},Ve={class:"p-2 border-bottom"},Se=["checked"],Ce=$(()=>e("span",{for:"all"},"全部",-1)),qe=["onClick"],Le=["id","value","checked"],Ie=["for"],Fe={__name:"Filter",props:{isFilterShow:Boolean,filterShowHandler:Function,resetKeyName:String},emits:["reset"],setup(y,{emit:p}){const _=y,E=["臺北","新北","桃園","臺中","臺南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","臺東","澎湖","金門","連江","基隆"],c=g({typeArr:[],cityArr:E,cityKeyWord:"",typeQuantity:5}),x=g(U()),P=N(),w=O(),t=g({dateValid:!1,type:"all",startDate:0,endDate:0,minPrice:0,maxPrice:1e5,city:"all"});B(_,()=>{switch(_.resetKeyName){case"dateValid":t.value.dateValid=!1,p("reset","all");break;case"type":t.value.type="all",p("reset","all");break;case"startDate":console.log("startDate"),t.value.startDate=0,p("reset","all");break;case"endDate":console.log("endDate"),t.value.endDate=0,p("reset","all");break;case"minPrice":console.log("minPrice"),t.value.minPrice=0,p("reset","all");break;case"maxPrice":console.log("maxPrice"),t.value.maxPrice=1e5,p("reset","all");break;case"city":console.log("city"),t.value.city="all",p("reset","all");break}});const M=r=>{r.preventDefault()};G(async()=>{x.value.exhibitionList.length===0&&await x.value.getAllExhibitionData(),j(),console.log("[BeforeMount]",x.value.exhibitionList),console.log("[BeforeMount]",P.query),B(t.value,r=>{typeof t.value.startDate=="object"&&(t.value.startDate=new Date(t.value.startDate).getTime()),typeof t.value.endDate=="object"&&(t.value.endDate=new Date(t.value.endDate).getTime()),w.replace({name:"SearchExhibition",query:{...P.query,...t.value}})})});const j=()=>{if(c.value.typeArr=Array.from(new Set(x.value.exhibitionList.map(r=>r.type))),Object.keys(P.query).length>0){const{dateValid:r,type:s,startDate:F,endDate:q,minPrice:L,maxPrice:I,city:l}=P.query,a={dateValid:r==="true",type:s,startDate:parseInt(F),endDate:parseInt(q),minPrice:parseInt(L),maxPrice:parseInt(I),city:l};t.value={...t.value,...a}}},V=(r,s)=>{console.log("click",r,s),t.value[`${r}`]=s,console.log("[fetch Data]",123)},C=r=>{r.preventDefault(),c.value.cityKeyWord=r.target.value,r.target.value===""&&(c.value.cityArr=E),console.log(c.value.cityArr.filter(s=>s.includes(r.target.value))),c.value.cityArr=E.filter(s=>s.includes(r.target.value))},A=r=>{switch(r){case"add":c.value.typeQuantity+=5;break;case"reset":c.value.typeQuantity=5;break}};return(r,s)=>{const F=k("CloseIcon"),q=k("DatePicker"),L=k("VeeField"),I=k("ErrorMessage"),l=k("VeeForm");return v(),f("div",{class:D(`side border-end ${y.isFilterShow?"w-0":"border-none"}`)},[e("div",{class:D(`m-4 ${y.isFilterShow&&"d-none"}`)},[e("div",ae,[e("button",{class:"btn border",onClick:s[0]||(s[0]=(...a)=>y.filterShowHandler&&y.filterShowHandler(...a))},[m(F),le])]),e("div",{onClick:s[1]||(s[1]=a=>V("dateValid",!t.value.dateValid)),class:"d-flex gap-2 align-items-center border-bottom pb-4 mb-4 px-3"},[e("input",{id:"date-valid",type:"checkbox",name:"checkbox",checked:t.value.dateValid},null,8,oe),se]),e("div",ne,[re,e("ul",ie,[e("li",ce,[e("div",{onClick:s[2]||(s[2]=a=>V("type","all"))},[e("input",{class:"me-2",id:"type-all",type:"radio",name:"type",value:"all",checked:t.value.type==="all"},null,8,de),ue])]),(v(!0),f(W,null,K(c.value.typeArr.slice(0,c.value.typeQuantity),(a,i)=>(v(),f("li",{class:"p-2 border-bottom",key:i},[e("div",{onClick:n=>V("type",a)},[e("input",{class:"me-2",id:a,type:"radio",name:"type",value:a,checked:t.value.type===a},null,8,ve),e("span",{class:"",for:a},u(a),9,ye)],8,pe)]))),128))]),e("div",be,[e("button",{class:D(`border-0 bg-transparent fw-bold ${c.value.typeQuantity<6&&"d-none"}`),type:"button",onClick:s[3]||(s[3]=a=>A("reset"))}," 收回 ",2),e("button",{onClick:s[4]||(s[4]=a=>A("add")),class:D(`border-0 bg-transparent fw-bold ms-auto ${c.value.typeArr.length<5&&"d-none"}`),type:"button"}," 顯示更多 ",2)])]),e("div",he,[_e,m(q,{modelValue:t.value.startDate,"onUpdate:modelValue":s[5]||(s[5]=a=>t.value.startDate=a),class:"mb-2",type:"number",placeholder:"開始時間"},null,8,["modelValue"]),m(q,{placeholder:"結束時間",modelValue:t.value.endDate,"onUpdate:modelValue":s[6]||(s[6]=a=>t.value.endDate=a)},null,8,["modelValue"])]),fe,m(l,{onSubmit:M},{default:Y(({errors:a})=>[e("div",me,[ge,m(L,{modelValue:t.value.minPrice,"onUpdate:modelValue":s[7]||(s[7]=i=>t.value.minPrice=i),class:D(`border rounded py-1 px-2 ${a.最小價格?"border-danger":"border"}`),placeholder:"最小價格",name:"最小價格",type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:0,max_value:t.value.maxPrice,numeric:!0}},null,8,["modelValue","class","rules"]),a.最小價格?(v(),T(I,{key:0,as:"p",class:"text-danger errorMessage",name:"最小價格"})):(v(),f("p",xe))]),e("div",we,[De,m(L,{modelValue:t.value.maxPrice,"onUpdate:modelValue":s[8]||(s[8]=i=>t.value.maxPrice=i),class:D(`border rounded py-1 px-2 ${a.最大價格?"border-danger":"border"}`),placeholder:"最大價格",name:"最大價格",type:"number",max:"100000",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:t.value.minPrice,max_value:1e5,numeric:!0}},null,8,["modelValue","class","rules"]),a.最大價格?(v(),T(I,{key:0,as:"p",class:"text-danger errorMessage",name:"最大價格"})):(v(),f("p",ke))])]),_:1}),e("div",null,[e("p",$e,"城市 "+u(c.value.cityKeyWord),1),e("input",{onInput:C,class:"border w-100 rounded px-2 py-1 mb-2",type:"search",placeholder:"篩選城市名稱",name:"cityKeyWord",id:"cityKeyWord"},null,32),e("ul",Pe,[e("li",Ve,[e("div",{onClick:s[9]||(s[9]=a=>V("city","all"))},[e("input",{class:"me-2",id:"all",type:"radio",name:"city",value:"all",checked:t.value.city==="all"},null,8,Se),Ce])]),(v(!0),f(W,null,K(c.value.cityArr,(a,i)=>(v(),f("li",{class:"p-2 border-bottom",key:i},[e("div",{onClick:n=>V("city",a)},[e("input",{class:"me-2",id:a,type:"radio",name:"city",value:a,checked:t.value.city===a},null,8,Le),e("span",{class:"",for:a},u(a),9,Ie)],8,qe)]))),128))])])],2),Z(" "+u(y.resetKeyName),1)],2)}}},Ee=R(Fe,[["__scopeId","data-v-c34b721d"]]);const Q=y=>(J("data-v-b3e78663"),y=y(),X(),y),Me={class:"d-flex"},Ae={class:"container position-relative px-3"},We={class:"mt-5 rounded-3"},Ke={class:"mb-2"},He={class:"mb-2"},Be={class:"fs-7"},Qe={class:"d-flex gap-2 mb-4"},je=["onClick"],Te={class:""},ze=Q(()=>e("span",null," 篩選器",-1)),Re={class:"row"},Ue={class:"border position-relative shadow rounded-3 overflow-hidden"},Ne={class:"position-absolute bg-secondary text-white px-3 py-2 border-bottom-end-3"},Oe={class:"rounded"},Ge=["src","alt"],Je={class:"p-3"},Xe={class:"card-title fw-bold"},Ye={class:"d-flex gap-2 mb-1"},Ze=Q(()=>e("span",null,"~",-1)),et={class:"d-flex"},tt={class:"border py-1 px-2 bg-success text-white rounded-pill fs-7"},at={class:"d-flex justify-content-center gap-1 mt-5 mb-5"},lt=Q(()=>e("span",null,"返回",-1)),ot={class:"pagination d-flex gap-1"},st=["onClick"],nt=Q(()=>e("span",null,"更多",-1)),rt={__name:"SearchExhibition",setup(y){const p=U(),_=N(),E=O(),c=g(""),x=g(),P=g(""),w=g([...p.exhibitionList]),t=g({nextBtnDisable:!1,counter:0,pageView:3,limit:8,currentPage:1}),M=g([]),j=l=>{t.value.currentPage=l},V=l=>{const a=p.exhibitionList.length%t.value.limit>0?1:0,n=(Math.floor(p.exhibitionList.length/t.value.limit)+a)/t.value.pageView-1;switch(l){case"next":if(t.value.counter>n)return;console.log(t.value.counter,n),t.value.counter++,t.value.currentPage=t.value.counter*t.value.pageView+1;break;case"pre":if(t.value.counter===0)return;t.value.counter--,t.value.currentPage=t.value.counter*t.value.pageView+1;break}},C=g(!1),A=()=>{C.value=!C.value,C.value===!1?window.matchMedia("(min-width:768px)")&&(document.querySelector("body").style="overflow:hidden"):document.querySelector("body").style=null},r=()=>{P.value=""},s=l=>{P.value=l},F=l=>{const{city:a,dateValid:i,startDate:n,endDate:d,maxPrice:H,minPrice:o,type:b}=l,h={dateValid:i==="false"?null:i,city:a==="all"?null:a,startDate:n!=="0"&&n!==void 0?parseInt(n):null,endDate:d!=="0"&&d!==void 0?parseInt(d):null,maxPrice:H==="100000"?null:parseInt(H),minPrice:o==="0"?null:parseInt(o),type:b==="all"?null:b};Object.keys(h).forEach(S=>{(h[S]===null||h[S]===void 0)&&delete h[S],(S==="maxPrice"||S==="minPrice")&&isNaN(h[S])&&delete h[S]}),(h.maxPrice<h.minPrice||h.maxPrice>1e5)&&(delete h.maxPrice,delete h.minPrice),x.value={...h}},q=ee.debounce(l=>{c.value=l.target.value,E.replace({name:"SearchExhibition",query:{..._.query,keyWord:c.value}})},300),L=()=>{console.log("[filterExhList start]",x.value);let l=[...p.exhibitionList];const a=x.value;Object.keys(a).map(i=>i).length===0&&console.log("全部展示"),Object.entries(a).forEach(([i,n])=>{switch(console.log(i,n),i){case"dateValid":if(n===!1)return;l=l.filter(d=>d.endDate>new Date().getTime()),console.log("篩選中-1:dateValid",l);break;case"city":if(n==="all")return;l=l.filter(d=>d.location.country===n),console.log("篩選中-2:city",l);break;case"startDate":if(n===0)return;l=l.filter(d=>d.startDate>=n),console.log("篩選中-3:startDate",l);break;case"endDate":if(n===0)return;l=l.filter(d=>d.endDate<=n);break;case"maxPrice":if(n===0)return;l=l.filter(d=>d.maxPrice>=n);break;case"minPrice":if(n===0)return;l=l.filter(d=>d.minPice<=n);break;case"type":if(n==="all")return;l=l.filter(d=>d.type===n)}}),_.query.keyWord!==""&&_.query.keyWord&&(console.log(_.query.keyWord),l=l.filter(i=>i.name.includes(_.query.keyWord)),console.log("search",l)),w.value=l,console.log("[filterExhlist] result:",w.value)},I=()=>{const l=window.matchMedia("(max-width:768px)");console.log(l),l.matches===!1&&(document.querySelector("body").style=null),l.matches===!0&&C?document.querySelector("body").style="overflow:hidden":document.querySelector("body").style=null};return G(async()=>{p.exhibitionList.length===0&&await p.getAllExhibitionData(),F(_.query),_.query.keyWord&&(document.querySelector(".search-keyword").value=_.query.keyWord,c.value=_.query.keyWord),w.value=p==null?void 0:p.exhibitionList.filter(l=>l.endDate>new Date().getTime()),L(),M.value=Array.from(Array(Math.ceil(w.value.length/t.value.limit)).keys()).slice(t.value.counter*t.value.pageView,(t.value.counter+1)*t.value.pageView),B(t.value,()=>{M.value=Array.from(Array(Math.ceil(w.value.length/t.value.limit)).keys()).slice(t.value.counter*t.value.pageView,(t.value.counter+1)*t.value.pageView)}),window.addEventListener("resize",I)}),te(()=>{window.removeEventListener("resize",I)}),B(_,()=>{F(_.query),L()}),(l,a)=>{const i=k("CloseIcon"),n=k("FilterMenu"),d=k("ChevronLeft"),H=k("ChevronRight");return v(),f("div",Me,[m(Ee,{"is-filter-show":C.value,"filter-show-handler":A,resetKeyName:P.value,onReset:r},null,8,["is-filter-show","resetKeyName"]),e("div",Ae,[e("div",We,[e("div",Ke,[e("input",{onInput:a[0]||(a[0]=(...o)=>z(q)&&z(q)(...o)),class:"search-keyword border rounded-1 px-2 py-1",type:"search",placeholder:"輸入展覽名稱"},null,32)]),e("div",He,[e("p",{class:D(`fs-7 ${!c.value.length>0&&"d-none"}`)}," 搜索關鍵字："+u(c.value),3),e("p",Be,"總搜索筆數("+u(w.value.length)+")",1)]),e("div",Qe,[(v(!0),f(W,null,K(x.value,(o,b,h)=>(v(),f("div",{class:"d-flex gap-2 align-items-center fs-7 border bg-transparent p-1 rounded",key:h},[e("button",{class:"p-0 border-0 bg-transparent",onClick:S=>s(b)},[m(i,{size:18})],8,je),e("p",Te,u(`${b==="dateValid"?"顯示結束展覽":""}`)+" "+u(`${b==="startDate"?`始於 ${new Date(o).toLocaleDateString()}`:""}`)+" "+u(`${b==="endDate"?`結束 ${new Date(o).toLocaleDateString()}`:""}`)+" "+u(`${b==="type"?`類別 ${o}`:""}`)+" "+u(`${b==="minPrice"?`最小價格 ${o}`:""}`)+" "+u(`${b==="maxPrice"?`最大價格 ${o}`:""}`)+" "+u(`${b==="city"?`城市 ${o}`:""}`),1)]))),128))])]),e("button",{class:"btn",type:"button",onClick:A},[m(n),ze]),e("div",Re,[(v(!0),f(W,null,K(w.value.slice(t.value.limit*(t.value.currentPage-1),t.value.limit*t.value.currentPage),(o,b)=>(v(),f("div",{key:b,class:"col-12 col-md-6 col-lg-4 col-xl-3 mb-4"},[e("div",Ue,[e("div",Ne,u(o==null?void 0:o.location.country),1),e("div",Oe,[e("img",{class:"image-box hover-scale",src:o==null?void 0:o.image,alt:o.name},null,8,Ge)]),e("div",Je,[e("div",Xe,[e("p",null,u(o==null?void 0:o.name),1)]),e("div",Ye,[e("span",null,u(new Date(o==null?void 0:o.startDate).toLocaleDateString()),1),Ze,e("span",null,u(new Date(o==null?void 0:o.endDate).toLocaleDateString()),1)]),e("ul",et,[e("li",tt,u(o==null?void 0:o.type),1)])])])]))),128))]),e("nav",at,[e("button",{onClick:a[1]||(a[1]=o=>V("pre")),class:"p-1 border border-1 rounded bg-transparent"},[m(d),lt]),e("ul",ot,[(v(!0),f(W,null,K(M.value,(o,b)=>(v(),f("li",{onClick:h=>j(o+1),key:b,class:D(`border p-2 rounded ${t.value.currentPage===o+1&&" bg-primary text-white"}`)},[e("button",{class:D(`border-0 bg-transparent ${t.value.currentPage===o+1&&"  text-white"}`)},u(o+1),3)],10,st))),128))]),e("button",{onClick:a[2]||(a[2]=o=>V("next")),class:"p-1 border border-1 rounded bg-transparent"},[m(H),nt])])])])}}},ct=R(rt,[["__scopeId","data-v-b3e78663"]]);export{ct as default};
