import{y as z,_ as $,r as h,z as w,A,B as E,v as P,w as U,C as V,c as u,d as _,f as a,q as c,D as B,E as F,p as R,k as L,G as H,b as N,g as D,i as O,F as j,H as I,t as S}from"./index-82fa8da3.js";import{c as K,a as k}from"./index.esm-d90f2761.js";const M=async n=>{try{return await z({method:"POST",url:"https://api.imgur.com/3/image",data:n,headers:{Authorization:"Client-ID 41da2d5848230ab"},mimeType:"multipart/form-data"})}catch(r){return console.log(r),r}};const T=n=>(R("data-v-30a7c061"),n=n(),L(),n),G={class:"border p-3 d-flex flex-column gap-4 rounded"},Q={class:"d-flex justify-content-center"},Y={class:"avatar-label border",for:"avatar"},J=["src"],W=T(()=>a("div",{class:"avatar-hover"},"點擊更改圖片",-1)),X=["disabled"],Z={key:0},aa={key:1},ea=T(()=>a("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),ta={__name:"AvatarUpload",setup(n){const r=h(!1),d=w(),i=A(),m=E(i),s=h(null),f=h(null),g=P(()=>{var t;return((t=i.userData)==null?void 0:t.picture)===s.value}),v=t=>{const l=t.target.files[0],e=new FormData,o=new FileReader;e.append("image",l),o.addEventListener("load",()=>{s.value=o.result,f.value=e}),l&&o.readAsDataURL(l)},y=async t=>{var l;try{r.value=!0;const e=await M(t),o=await F((l=i.userData)==null?void 0:l.localId,{picture:e.data.data.link});return s.value=e.data.data.link,i.userData.picture=e.data.data.link,console.log("[upload imgur responses]",e.data.data.link),console.log("[upload fireBase user data]",o),o&&d.callAlert({title:"圖片上傳成功",type:"check"}),r.value=!1,e.data.data.link}catch(e){return console.log("[upload img responses Error]",e),r.value=!1,d.callAlert({title:"圖片上傳失敗",type:"error"}),e}},x=()=>{var t;s.value=(t=i.userData)==null?void 0:t.picture};return U(m.userData,()=>{var t;s.value=(t=i.userData)==null?void 0:t.picture}),V(()=>{x()}),(t,l)=>{var e;return u(),_("div",G,[a("div",Q,[a("label",Y,[a("img",{class:"avatar-img",src:s.value||((e=c(i).userData)==null?void 0:e.picture),alt:"avatar",width:"200",height:"200"},null,8,J),W]),a("input",{class:"d-none",onChange:v,type:"file",name:"avatar",id:"avatar",accept:"image/*"},null,32)]),a("button",{onClick:l[0]||(l[0]=o=>y(f.value)),class:"btn btn-dark",disabled:g.value||r.value},[r.value===!1?(u(),_("p",Z,"上傳")):(u(),_("div",aa,[ea,B(" Loading... ")]))],8,X)])}}},sa=$(ta,[["__scopeId","data-v-30a7c061"]]);const b=n=>(R("data-v-4fddad54"),n=n(),L(),n),oa=b(()=>a("h1",{class:"border-bottom mb-4 fs-4 pb-3 fw-medium"},"會員資料",-1)),ra={class:"row"},la={class:"col-md-4"},na={class:"col-md-8"},ia=b(()=>a("label",{for:"name",class:"form-label"},"暱稱",-1)),ca={class:"text-danger error-text"},da={class:"d-flex flex-column"},ua=b(()=>a("label",{class:"form-label",for:"email"},"信箱",-1)),_a={class:"text-danger error-text"},ma={class:"btn btn-dark ms-auto py-2 px-4 fw-medium mt-4"},pa={key:0},fa={key:1},va=b(()=>a("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),ha={__name:"UserInfo",setup(n){const r=w(),d=A(),i=E(d),m=h(!1),{errors:s,setValues:f,handleSubmit:g,defineInputBinds:v}=H({initialValues:{name:"",email:""},validationSchema:K({name:k().required("喊稱不能為空").max(20,"最多請不要超過20字元"),email:k().email("請輸入正確Email").required("請勿空白")})}),y=v("email"),x=v("name"),t=g(async e=>{var o;m.value=!0;try{const p=await F((o=d.userData)==null?void 0:o.localId,e),{email:C,name:q}=p.data;d.userData.email=C,d.userData.name=q,r.callAlert({title:"用戶資訊更改成功",type:"check"})}catch(p){console.error("[infoSubmit Error]",p),r.callAlert({title:"用戶資訊更改失敗",type:"error"})}m.value=!1}),l=()=>{const{email:e,name:o}=i.userData.value;f({email:e,name:o})};return U(i.userData,()=>{l()}),V(()=>{l()}),(e,o)=>{const p=N("VeeForm");return u(),_(j,null,[oa,a("div",ra,[a("div",la,[D(sa)]),a("div",na,[D(p,{class:"d-flex flex-column gap-2 mb-4",onSubmit:c(t)},{default:O(()=>[a("div",null,[ia,a("input",I({class:`form-control ${c(s).name&&"is-invalid"}`},c(x),{type:"text",name:"name",id:"name"}),null,16),a("small",ca,S(c(s).name&&c(s).name),1)]),a("div",da,[ua,a("input",I({class:`form-control ${c(s).email&&"is-invalid"}`},c(y),{type:"text",name:"email",id:"email"}),null,16),a("small",_a,S(c(s).email&&c(s).email),1)]),a("button",ma,[m.value===!1?(u(),_("p",pa,"確認")):(u(),_("div",fa,[va,B(" Loading... ")]))])]),_:1},8,["onSubmit"])])])],64)}}},ya=$(ha,[["__scopeId","data-v-4fddad54"]]);export{ya as default};
