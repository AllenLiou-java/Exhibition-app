import{_ as O,r as x,e as G,u as J,a as X,w as j,o as Y,b as D,c as u,d as f,f as t,g,F as A,h as K,t as d,n as k,i as z,j as U,k as te,p as Z,l as ee,m as ae,q as le,s as Q,R as N}from"./index-f88de99f.js";const $=p=>(Z("data-v-c34b721d"),p=p(),ee(),p),oe={class:"w-100 mb-2 d-block d-md-none"},se=$(()=>t("span",null," Close",-1)),ne=["checked"],re=$(()=>t("p",{for:"date-valid",class:"pb-1"}," 顯示已結束展覽 ",-1)),ce={class:"mb-3"},ie=$(()=>t("p",{class:"fw-bold mb-2"},"類型",-1)),de={class:"type-list rounded-3 border mb-1"},ue={class:"border-bottom p-2"},pe=["checked"],ve=$(()=>t("span",{for:"type-all"},"全部",-1)),ye=["onClick"],be=["id","value","checked"],he=["for"],_e={class:"d-flex px-1"},fe={class:"mb-2"},ge=$(()=>t("p",{class:"fw-bold mb-2"},"展覽期間",-1)),me=$(()=>t("p",{class:"mb-2 fw-bold"},"價格",-1)),xe={class:"d-flex flex-column"},we=$(()=>t("p",{class:"mb-1 fs-7"},"最小票價",-1)),ke={key:1,class:"errorMessage"},De={class:"d-flex flex-column"},$e=$(()=>t("p",{class:"mb-1 fs-7"},"最大票價",-1)),Pe={key:1,class:"errorMessage"},Ve={class:"fs-7 mb-2 fw-bold"},Se={class:"city-list border rounded-3"},Ce={class:"p-2 border-bottom"},qe=["checked"],Ie=$(()=>t("span",{for:"all"},"全部",-1)),Le=["onClick"],Ee=["id","value","checked"],Fe=["for"],Me={__name:"Filter",props:{isFilterShow:Boolean,filterShowHandler:Function,resetKeyName:String},emits:["reset"],setup(p,{emit:v}){const _=p,M=["臺北","新北","桃園","臺中","臺南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","臺東","澎湖","金門","連江","基隆"],c=x({typeArr:[],cityArr:M,cityKeyWord:"",typeQuantity:5}),w=x(G()),P=J(),m=X(),a=x({dateValid:!1,type:"all",startDate:0,endDate:0,minPrice:0,maxPrice:1e5,city:"all"});j(_,()=>{switch(_.resetKeyName){case"dateValid":a.value.dateValid=!1,v("reset","all");break;case"type":a.value.type="all",v("reset","all");break;case"startDate":console.log("startDate"),a.value.startDate=0,v("reset","all");break;case"endDate":console.log("endDate"),a.value.endDate=0,v("reset","all");break;case"minPrice":console.log("minPrice"),a.value.minPrice=0,v("reset","all");break;case"maxPrice":console.log("maxPrice"),a.value.maxPrice=1e5,v("reset","all");break;case"city":console.log("city"),a.value.city="all",v("reset","all");break}});const H=r=>{r.preventDefault()};Y(async()=>{w.value.exhibitionList.length===0&&await w.value.getAllExhibitionData(),T(),console.log("[BeforeMount]",w.value.exhibitionList),console.log("[BeforeMount]",P.query),j(a.value,r=>{typeof a.value.startDate=="object"&&(a.value.startDate=new Date(a.value.startDate).getTime()),typeof a.value.endDate=="object"&&(a.value.endDate=new Date(a.value.endDate).getTime()),m.replace({name:"SearchExhibition",query:{...P.query,...a.value}})})});const T=()=>{if(c.value.typeArr=Array.from(new Set(w.value.exhibitionList.map(r=>r.type))),Object.keys(P.query).length>0){const{dateValid:r,type:o,startDate:W,endDate:q,minPrice:I,maxPrice:L,city:F}=P.query,e={dateValid:r==="true",type:o,startDate:parseInt(W),endDate:parseInt(q),minPrice:parseInt(I),maxPrice:parseInt(L),city:F};a.value={...a.value,...e}}},V=(r,o)=>{console.log("click",r,o),a.value[`${r}`]=o,console.log("[fetch Data]",123)},E=r=>{r.preventDefault(),c.value.cityKeyWord=r.target.value,r.target.value===""&&(c.value.cityArr=M),console.log(c.value.cityArr.filter(o=>o.includes(r.target.value))),c.value.cityArr=M.filter(o=>o.includes(r.target.value))},S=r=>{switch(r){case"add":c.value.typeQuantity+=5;break;case"reset":c.value.typeQuantity=5;break}};return(r,o)=>{const W=D("CloseIcon"),q=D("DatePicker"),I=D("VeeField"),L=D("ErrorMessage"),F=D("VeeForm");return u(),f("div",{class:k(`side border-end ${p.isFilterShow?"w-0":"border-none"}`)},[t("div",{class:k(`m-4 ${p.isFilterShow&&"d-none"}`)},[t("div",oe,[t("button",{class:"btn border",onClick:o[0]||(o[0]=(...e)=>p.filterShowHandler&&p.filterShowHandler(...e))},[g(W),se])]),t("div",{onClick:o[1]||(o[1]=e=>V("dateValid",!a.value.dateValid)),class:"d-flex gap-2 align-items-center border-bottom pb-4 mb-4 px-3"},[t("input",{id:"date-valid",type:"checkbox",name:"checkbox",checked:a.value.dateValid},null,8,ne),re]),t("div",ce,[ie,t("ul",de,[t("li",ue,[t("div",{onClick:o[2]||(o[2]=e=>V("type","all"))},[t("input",{class:"me-2",id:"type-all",type:"radio",name:"type",value:"all",checked:a.value.type==="all"},null,8,pe),ve])]),(u(!0),f(A,null,K(c.value.typeArr.slice(0,c.value.typeQuantity),(e,n)=>(u(),f("li",{class:"p-2 border-bottom",key:n},[t("div",{onClick:y=>V("type",e)},[t("input",{class:"me-2",id:e,type:"radio",name:"type",value:e,checked:a.value.type===e},null,8,be),t("span",{class:"",for:e},d(e),9,he)],8,ye)]))),128))]),t("div",_e,[t("button",{class:k(`border-0 bg-transparent fw-bold ${c.value.typeQuantity<6&&"d-none"}`),type:"button",onClick:o[3]||(o[3]=e=>S("reset"))}," 收回 ",2),t("button",{onClick:o[4]||(o[4]=e=>S("add")),class:k(`border-0 bg-transparent fw-bold ms-auto ${c.value.typeArr.length<5&&"d-none"}`),type:"button"}," 顯示更多 ",2)])]),t("div",fe,[ge,g(q,{modelValue:a.value.startDate,"onUpdate:modelValue":o[5]||(o[5]=e=>a.value.startDate=e),class:"mb-2",type:"number",placeholder:"開始時間"},null,8,["modelValue"]),g(q,{placeholder:"結束時間",modelValue:a.value.endDate,"onUpdate:modelValue":o[6]||(o[6]=e=>a.value.endDate=e)},null,8,["modelValue"])]),me,g(F,{onSubmit:H},{default:z(({errors:e})=>[t("div",xe,[we,g(I,{modelValue:a.value.minPrice,"onUpdate:modelValue":o[7]||(o[7]=n=>a.value.minPrice=n),class:k(`border rounded py-1 px-2 ${e.最小價格?"border-danger":"border"}`),placeholder:"最小價格",name:"最小價格",type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:0,max_value:a.value.maxPrice,numeric:!0}},null,8,["modelValue","class","rules"]),e.最小價格?(u(),U(L,{key:0,as:"p",class:"text-danger errorMessage",name:"最小價格"})):(u(),f("p",ke))]),t("div",De,[$e,g(I,{modelValue:a.value.maxPrice,"onUpdate:modelValue":o[8]||(o[8]=n=>a.value.maxPrice=n),class:k(`border rounded py-1 px-2 ${e.最大價格?"border-danger":"border"}`),placeholder:"最大價格",name:"最大價格",type:"number",max:"100000",oninput:"value=value.replace(/[^\\d]/g,'')",rules:{min_value:a.value.minPrice,max_value:1e5,numeric:!0}},null,8,["modelValue","class","rules"]),e.最大價格?(u(),U(L,{key:0,as:"p",class:"text-danger errorMessage",name:"最大價格"})):(u(),f("p",Pe))])]),_:1}),t("div",null,[t("p",Ve,"城市 "+d(c.value.cityKeyWord),1),t("input",{onInput:E,class:"border w-100 rounded px-2 py-1 mb-2",type:"search",placeholder:"篩選城市名稱",name:"cityKeyWord",id:"cityKeyWord"},null,32),t("ul",Se,[t("li",Ce,[t("div",{onClick:o[9]||(o[9]=e=>V("city","all"))},[t("input",{class:"me-2",id:"all",type:"radio",name:"city",value:"all",checked:a.value.city==="all"},null,8,qe),Ie])]),(u(!0),f(A,null,K(c.value.cityArr,(e,n)=>(u(),f("li",{class:"p-2 border-bottom",key:n},[t("div",{onClick:y=>V("city",e)},[t("input",{class:"me-2",id:e,type:"radio",name:"city",value:e,checked:a.value.city===e},null,8,Ee),t("span",{class:"",for:e},d(e),9,Fe)],8,Le)]))),128))])])],2),te(" "+d(p.resetKeyName),1)],2)}}},We=O(Me,[["__scopeId","data-v-c34b721d"]]);const R=p=>(Z("data-v-d3150f36"),p=p(),ee(),p),Ae={class:"d-flex"},Ke={class:"container position-relative px-3"},He={class:"mt-5 rounded-3"},Be={class:"mb-2"},Qe={class:"mb-2"},je={class:"fs-7"},Re={class:"d-flex gap-2 mb-4"},Te=["onClick"],ze={class:""},Ue=R(()=>t("span",null," 篩選器",-1)),Ne={class:"row"},Oe={class:"border position-relative shadow rounded-3 overflow-hidden"},Ge={class:"position-absolute bg-secondary text-white px-3 py-2 border-bottom-end-3"},Je=["src","alt"],Xe={class:"p-3"},Ye={class:"card-title fw-bold"},Ze={class:"d-flex gap-2 mb-1"},et=R(()=>t("span",null,"~",-1)),tt={class:"d-flex"},at={class:"border py-1 px-2 bg-success text-white rounded-pill fs-7"},lt={class:"d-flex justify-content-center gap-1 mt-5 mb-5"},ot=R(()=>t("span",null,"返回",-1)),st={class:"pagination d-flex gap-1"},nt=["onClick"],rt=R(()=>t("span",null,"更多",-1)),ct={__name:"SearchExhibition",setup(p){const v=G(),_=J(),M=X(),c=x(""),w=x(),P=x(""),m=x([...v.exhibitionList]),a=x({nextBtnDisable:!1,counter:0,pageView:3,limit:8,currentPage:1}),H=x([]),T=e=>{a.value.currentPage=e},V=e=>{const n=m.value.length%a.value.limit>0?1:0,y=Math.floor(m.value.length/a.value.limit)+n,s=Math.ceil(y/a.value.pageView);switch(e){case"next":if(a.value.counter+1>=s)return;console.log(a.value.counter,s),a.value.counter++,a.value.currentPage=a.value.counter*a.value.pageView+1;break;case"pre":if(a.value.counter===0)return;a.value.counter--,a.value.currentPage=a.value.counter*a.value.pageView+1;break}},E=()=>{H.value=Array.from(Array(Math.ceil(m.value.length/a.value.limit)).keys()).slice(a.value.counter*a.value.pageView,(a.value.counter+1)*a.value.pageView)},S=x(!1),r=()=>{S.value=!S.value,S.value===!1?window.matchMedia("(min-width:768px)")&&(document.querySelector("body").style="overflow:hidden"):document.querySelector("body").style=null},o=()=>{P.value=""},W=e=>{P.value=e},q=e=>{const{city:n,dateValid:y,startDate:s,endDate:i,maxPrice:B,minPrice:l,type:b}=e,h={dateValid:y==="false"?null:y,city:n==="all"?null:n,startDate:s!=="0"&&s!==void 0?parseInt(s):null,endDate:i!=="0"&&i!==void 0?parseInt(i):null,maxPrice:B==="100000"?null:parseInt(B),minPrice:l==="0"?null:parseInt(l),type:b==="all"?null:b};Object.keys(h).forEach(C=>{(h[C]===null||h[C]===void 0)&&delete h[C],(C==="maxPrice"||C==="minPrice")&&isNaN(h[C])&&delete h[C]}),(h.maxPrice<h.minPrice||h.maxPrice>1e5)&&(delete h.maxPrice,delete h.minPrice),E(),w.value={...h}},I=ae.debounce(e=>{c.value=e.target.value,M.replace({name:"SearchExhibition",query:{..._.query,keyWord:c.value}})},300),L=()=>{console.log("[filterExhList start]",w.value);let e=[...v.exhibitionList];const n=w.value;Object.keys(n).map(y=>y).length===0&&console.log("全部展示"),Object.entries(n).forEach(([y,s])=>{switch(console.log(y,s),y){case"dateValid":if(s===!1)return;e=e.filter(i=>i.endDate>new Date().getTime()),console.log("篩選中-1:dateValid",e);break;case"city":if(s==="all")return;e=e.filter(i=>i.location.country===s),console.log("篩選中-2:city",e);break;case"startDate":if(s===0)return;e=e.filter(i=>i.startDate>=s),console.log("篩選中-3:startDate",e);break;case"endDate":if(s===0)return;e=e.filter(i=>i.endDate<=s);break;case"maxPrice":if(s===0)return;e=e.filter(i=>i.maxPrice>=s);break;case"minPrice":if(s===0)return;e=e.filter(i=>i.minPice<=s);break;case"type":if(s==="all")return;e=e.filter(i=>i.type===s)}}),_.query.keyWord!==""&&_.query.keyWord&&(console.log(_.query.keyWord),e=e.filter(y=>y.name.includes(_.query.keyWord)),console.log("search",e)),m.value=e,console.log("[filterExhlist] result:",m.value)},F=()=>{const e=window.matchMedia("(max-width:768px)");console.log(e),e.matches===!1&&(document.querySelector("body").style=null),e.matches===!0&&S?document.querySelector("body").style="overflow:hidden":document.querySelector("body").style=null};return Y(async()=>{v.exhibitionList.length===0&&await v.getAllExhibitionData(),q(_.query),_.query.keyWord&&(document.querySelector(".search-keyword").value=_.query.keyWord,c.value=_.query.keyWord),m.value=v==null?void 0:v.exhibitionList.filter(e=>e.endDate>new Date().getTime()),L(),E(),j(a.value,()=>{E()}),window.addEventListener("resize",F)}),le(()=>{window.removeEventListener("resize",F)}),j(_,()=>{q(_.query),L(),a.value.counter=0,a.value.currentPage=1,E()}),(e,n)=>{const y=D("CloseIcon"),s=D("FilterMenu"),i=D("ChevronLeft"),B=D("ChevronRight");return u(),f("div",Ae,[g(We,{"is-filter-show":S.value,"filter-show-handler":r,resetKeyName:P.value,onReset:o},null,8,["is-filter-show","resetKeyName"]),t("div",Ke,[t("div",He,[t("div",Be,[t("input",{onInput:n[0]||(n[0]=(...l)=>Q(I)&&Q(I)(...l)),class:"search-keyword border rounded-1 px-2 py-1",type:"search",placeholder:"輸入展覽名稱"},null,32)]),t("div",Qe,[t("p",{class:k(`fs-7 ${!c.value.length>0&&"d-none"}`)}," 搜索關鍵字："+d(c.value),3),t("p",je,"總搜索筆數("+d(m.value.length)+")",1)]),t("div",Re,[(u(!0),f(A,null,K(w.value,(l,b,h)=>(u(),f("div",{class:"d-flex gap-2 align-items-center fs-7 border bg-transparent p-1 rounded",key:h},[t("button",{class:"p-0 border-0 bg-transparent",onClick:C=>W(b)},[g(y,{size:18})],8,Te),t("p",ze,d(`${b==="dateValid"?"顯示結束展覽":""}`)+" "+d(`${b==="startDate"?`始於 ${new Date(l).toLocaleDateString()}`:""}`)+" "+d(`${b==="endDate"?`結束 ${new Date(l).toLocaleDateString()}`:""}`)+" "+d(`${b==="type"?`類別 ${l}`:""}`)+" "+d(`${b==="minPrice"?`最小價格 ${l}`:""}`)+" "+d(`${b==="maxPrice"?`最大價格 ${l}`:""}`)+" "+d(`${b==="city"?`城市 ${l}`:""}`),1)]))),128))])]),t("button",{class:"btn",type:"button",onClick:r},[g(s),Ue]),t("div",Ne,[(u(!0),f(A,null,K(m.value.slice(a.value.limit*(a.value.currentPage-1),a.value.limit*a.value.currentPage),(l,b)=>(u(),f("div",{key:b,class:"col-12 col-md-6 col-lg-4 col-xl-3 mb-4"},[t("div",Oe,[t("div",Ge,d(l==null?void 0:l.location.country),1),g(Q(N),{class:"text-dark rounded",to:`viewExhibition/${l==null?void 0:l.id}`},{default:z(()=>[t("img",{class:"image-box hover-scale",src:l==null?void 0:l.image,alt:l.name},null,8,Je)]),_:2},1032,["to"]),t("div",Xe,[t("div",Ye,[g(Q(N),{class:"text-dark",to:`viewExhibition/${l==null?void 0:l.id}`},{default:z(()=>[t("p",null,d(l==null?void 0:l.name),1)]),_:2},1032,["to"])]),t("div",Ze,[t("span",null,d(new Date(l==null?void 0:l.startDate).toLocaleDateString()),1),et,t("span",null,d(new Date(l==null?void 0:l.endDate).toLocaleDateString()),1)]),t("ul",tt,[t("li",at,d(l==null?void 0:l.type),1)])])])]))),128))]),t("nav",lt,[t("button",{onClick:n[1]||(n[1]=l=>V("pre")),class:"p-1 border border-1 rounded bg-transparent"},[g(i),ot]),t("ul",st,[(u(!0),f(A,null,K(H.value,(l,b)=>(u(),f("li",{onClick:h=>T(l+1),key:b,class:k(`border p-2 rounded ${a.value.currentPage===l+1&&" bg-primary text-white"}`)},[t("button",{class:k(`border-0 bg-transparent ${a.value.currentPage===l+1&&"  text-white"}`)},d(l+1),3)],10,nt))),128))]),t("button",{onClick:n[2]||(n[2]=l=>V("next")),class:"p-1 border border-1 rounded bg-transparent"},[g(B),rt])])])])}}},dt=O(ct,[["__scopeId","data-v-d3150f36"]]);export{dt as default};
