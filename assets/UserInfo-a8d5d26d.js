import{y as C,_ as S,r as v,z as $,A as k,v as q,w as U,B as V,c,d as u,f as a,q as d,C as B,D as E,p as A,k as F,E as z,b as N,g as y,i as O,F as P,G as D,t as I}from"./index-7e4dccfe.js";import{c as j,a as w}from"./index.esm-0b822089.js";const H=async l=>{try{return await C({method:"POST",url:"https://api.imgur.com/3/image",data:l,headers:{Authorization:"Client-ID 41da2d5848230ab"},mimeType:"multipart/form-data"})}catch(s){return console.log(s),s}};const R=l=>(A("data-v-e4d5c10f"),l=l(),F(),l),K={class:"border p-3 d-flex flex-column gap-4 rounded"},M={class:"d-flex justify-content-center"},G={class:"avatar-label border",for:"avatar"},J=["src"],Q=R(()=>a("div",{class:"avatar-hover"},"點擊更改圖片",-1)),Y=["disabled"],W={key:0},X={key:1},Z=R(()=>a("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),aa={__name:"AvatarUpload",setup(l){const s=v(!1),i=$(),_=k(i),o=v(null),p=v(null),b=q(()=>{var t;return((t=i.userData)==null?void 0:t.picture)===o.value}),f=t=>{const r=t.target.files[0],e=new FormData,n=new FileReader;e.append("image",r),n.addEventListener("load",()=>{o.value=n.result,p.value=e}),r&&n.readAsDataURL(r)},g=async t=>{var r;try{s.value=!0;const e=await H(t),n=await E((r=i.userData)==null?void 0:r.localId,{picture:e.data.data.link});return o.value=e.data.data.link,i.userData.picture=e.data.data.link,console.log("[upload imgur responses]",e.data.data.link),console.log("[upload fireBase user data]",n),n&&window.alert("圖片上傳成功"),s.value=!1,e.data.data.link}catch(e){return console.log("[upload img responses Error]",e),s.value=!1,e}},x=()=>{var t;o.value=(t=i.userData)==null?void 0:t.picture};return U(_.userData,()=>{var t;o.value=(t=i.userData)==null?void 0:t.picture}),V(()=>{x()}),(t,r)=>{var e;return c(),u("div",K,[a("div",M,[a("label",G,[a("img",{class:"avatar-img",src:o.value||((e=d(i).userData)==null?void 0:e.picture),alt:"avatar",width:"200",height:"200"},null,8,J),Q]),a("input",{class:"d-none",onChange:f,type:"file",name:"avatar",id:"avatar",accept:"image/*"},null,32)]),a("button",{onClick:r[0]||(r[0]=n=>g(p.value)),class:"btn btn-dark",disabled:b.value||s.value},[s.value===!1?(c(),u("p",W,"上傳")):(c(),u("div",X,[Z,B(" Loading... ")]))],8,Y)])}}},ea=S(aa,[["__scopeId","data-v-e4d5c10f"]]);const h=l=>(A("data-v-bfd4df48"),l=l(),F(),l),ta=h(()=>a("h2",{class:"border-bottom mb-4 fs-4 pb-3 fw-medium"},"會員資料",-1)),sa={class:"row"},oa={class:"col-md-4"},na={class:"col-md-8"},ra=h(()=>a("label",{for:"name",class:"form-label"},"暱稱",-1)),la={class:"text-danger error-text"},ia={class:"d-flex flex-column"},da=h(()=>a("label",{class:"form-label",for:"email"},"信箱",-1)),ca={class:"text-danger error-text"},ua={class:"btn btn-dark ms-auto py-2 px-4 fw-medium mt-4"},_a={key:0},ma={key:1},pa=h(()=>a("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),fa={__name:"UserInfo",setup(l){const s=$(),i=k(s),_=v(!1),{errors:o,setValues:p,handleSubmit:b,defineInputBinds:f}=z({initialValues:{name:"",email:""},validationSchema:j({name:w().required("喊稱不能為空").max(20,"最多請不要超過20字元"),email:w().email("請輸入正確Email").required("請勿空白")})}),g=f("email"),x=f("name"),t=b(async e=>{var n;_.value=!0;try{const m=await E((n=s.userData)==null?void 0:n.localId,e),{email:L,name:T}=m.data;s.userData.email=L,s.userData.name=T,alert("用戶資訊更改成功！")}catch(m){alert(JSON.stringify(m,null,2))}_.value=!1}),r=()=>{const{email:e,name:n}=i.userData.value;p({email:e,name:n})};return U(i.userData,()=>{r()}),V(()=>{r()}),(e,n)=>{const m=N("VeeForm");return c(),u(P,null,[ta,a("div",sa,[a("div",oa,[y(ea)]),a("div",na,[y(m,{class:"d-flex flex-column gap-2 mb-4",onSubmit:d(t)},{default:O(()=>[a("div",null,[ra,a("input",D({class:`form-control ${d(o).name&&"is-invalid"}`},d(x),{type:"text",name:"name",id:"name"}),null,16),a("small",la,I(d(o).name&&d(o).name),1)]),a("div",ia,[da,a("input",D({class:`form-control ${d(o).email&&"is-invalid"}`},d(g),{type:"text",name:"email",id:"email"}),null,16),a("small",ca,I(d(o).email&&d(o).email),1)]),a("button",ua,[_.value===!1?(c(),u("p",_a,"確認")):(c(),u("div",ma,[pa,B(" Loading... ")]))])]),_:1},8,["onSubmit"])])])],64)}}},ba=S(fa,[["__scopeId","data-v-bfd4df48"]]);export{ba as default};
